<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="layui/css/layui.css">
    <link rel="stylesheet" href="layui/css/layui.mobile.css">
    <link rel="stylesheet" href="layui/myicon/iconfont.css">
    <link rel="stylesheet" href="mui/css/mui.css">
    <script src="js/jquery-1.10.2.min.js"></script>
    <script src="mui/js/mui.min.js"></script>
    <script src="echarts/echarts.min.js"></script>
    <script src="layui/layui.all.js"></script>
    <script src="layui/myicon/iconfont.js"></script>
    <title>Document</title>
</head>
<style>
    table tbody {
        display: block;
        height: 400px;
        overflow-y: scroll;
    }
    table thead,
    tbody tr {
        display: table;
        width: 100%;
        table-layout: fixed;
    }
  .layui-layout-admin .layui-footer {
    position: fixed;
    left: 200px;
    left: 0;
    bottom: 0;
    height: 44px;
    line-height: 44px;
    padding: 0;
    background-color: #eee;
    width: 100%;
    text-align: center;
}
.layui-body {
    position: absolute;
    /* left: 200px; */
    left: 0;
    top: 0;
    bottom: 0;
    z-index: 998;
    width: 100%;
    overflow-y: auto;
    box-sizing: border-box;
}
.layui-layout-admin .layui-body {
    position: fixed;
    top: 40px;
    bottom: 44px;
}
.pId{
  margin-top:10px;
  font-size: 12px;
  color:grey;
}
.mui-table-view-cell > a:not(.mui-btn){
  font-size: 14px;
}
.mui-card-header:after, .mui-card-footer:before{
    background-color: #fff;
}
/* .oth{
    position: absolute;
    top: 10%;
    right: 5%;
    width: 60%;
    
} */
.mui-table-view-cell{
    float: left;
    padding: 2px 13px;
}
.mui-table-view-cell:after{
    background-color: #fff;
}
.mui-table-view-cell1{
    float: left;
    padding: 9px 44px;
}
.layui-tab-title li{
  display: inline-block;
    *display: inline;
    *zoom: 1;
    vertical-align: middle;
    font-size: 14px;
    transition: all .2s;
    -webkit-transition: all .2s;
    /* position: absolute; */
    line-height: 40px;
    min-width: 65px;
    /* padding: 0em 0em; */
    text-align: center;
    cursor: pointer;
    width: 50%;
}
.layui-tab-title .layui-this{
  color:#fff;
  background-color: #007aff;
}
.layui-table td, .layui-table th{
  position: relative;
    padding: 9px 0px;
    min-height: 20px;
    line-height: 20px;
    font-size: 10px;
    text-align: center;
}
</style>
<body class="layui-layout-body">
  
  <div class="layui-layout layui-layout-admin">
    <div class="layui-header" style="height:40px;text-align: center;color: #eee;">
      <!-- <div class="layui-logo1" style="line-height: 40px;"><img src="images/logo.png" style="width: 80%;"></div> -->
      <div class="layui-logo1" style="line-height: 40px;">停车场管理平台</div>
      <!-- 头部区域（可配合layui已有的水平导航） -->
  </div>
    <div class="layui-body">
        <div style="margin: 10px;" id="tlt">
          <div>停车场名称<a href="index.html" style="float: right;">切换</a></div> 
        </div>
        <div class="mui-card">
            <!--页眉，放置标题-->
            <div class="mui-card-header">
                <div style="font-size: 14px;">收益分析</div>
                <div style="font-size:12px;color:gray;float: right;" id="time"></div>
            </div>
            <!--内容区-->
            <div class="mui-card-content">
                <!-- <div id="mainchart" style="width: 40vw;height:10vh;"></div> -->
                <div class="oth mui-row" id="money">
                    
                <div>
                  <ul class="mui-table-view">
                   
                    <li class="mui-table-view-cell mui-col-sm-4 mui-col-xs-4" style="text-align: center;"> 
                        <span style="font-size: 23px;color:#2980B9 ;" id="moncost">0</span>
                        <span style="font-size:8px;color:#7F8C8D">元</span>
                        <div style="font-size: 8px;color: gray;background-color: #2980B9;border-radius: 7px;color: white;">
                          <span style="font-size: 15px;">当月累计收入</span>
                        </div>
                    </li>
                    <li class="mui-table-view-cell mui-col-sm-4 mui-col-xs-4" style="text-align: center;">
                        <span style="font-size: 23px;color:#D35400" id="weekcost">0</span>
                        <span style="font-size:8px;color:#7F8C8D">元</span>
                        <div style="font-size: 8px;color: gray;background-color: #D35400;border-radius: 7px;color: white;">
                          <span style="font-size: 15px;">当周累计收入</span>
                        </div>
                    </li>
                    <li class="mui-table-view-cell mui-col-sm-4 mui-col-xs-4" style="text-align: center;">
                      <span style="font-size: 23px;color:#9B59B6;" id="daycost">0</span>
                      <span style="font-size:8px;color:#7F8C8D">元</span>
                      <div style="font-size: 8px;color: gray;background-color: #9B59B6;border-radius: 7px;color: white;">
                        <span style="font-size: 15px;">当日累计收入</span>
                      </div>
                  </li>
                </ul>
                </div>
                   
                </div>
            </div>
            <!--页脚，放置补充信息或支持的操作-->
            <div class="mui-card-content">
              <div class="mui-card-header">
                <div style="font-size: 14px;">车场信息</div>
            </div>
                <div class="mui-row">
                    <ul class="mui-table-view" id="cc">
                       
                        <li class="mui-table-view-cell mui-col-sm-4 mui-col-xs-4" style="text-align: center;"> 
                            <span style="font-size: 23px;color:#007aff ;" id="incar">0</span>
                            <span style="font-size:8px;color:#7F8C8D" >辆</span>
                            <div style="font-size: 15px;background-color: #007aff;border-radius: 7px;color: white;"><span>在场车辆</span></div>
                        </li>
                        <li class="mui-table-view-cell mui-col-sm-4 mui-col-xs-4" style="text-align: center;">
                            <span style="font-size: 23px;color:green" id="outcar">0</span>
                            <span style="font-size:8px;color:#7F8C8D">辆</span>
                            <div style="font-size: 15px;background-color: green;border-radius: 7px;color: white;"><span>离场车辆</span></div>
                        </li>
                        <li class="mui-table-view-cell mui-col-sm-4 mui-col-xs-4" style="text-align: center;">
                          <span style="font-size: 23px;color:orange" id="extraNum">100</span>
                          <span style="font-size:8px;color:#7F8C8D" id="allNum">/1000个</span>
                          <div style="font-size: 15px;background-color: orange;border-radius: 7px;color: white;"><span>剩余车位</span></div>
                      </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="layui-tab" style="margin:10px;background-color:white;">
          <ul class="layui-tab-title">
            <li class="layui-this">进场车辆</li>
            <li>出场车辆</li>
          </ul>
          <div class="layui-tab-content">
            <div class="layui-tab-item layui-show">
              <table class="layui-table" lay-even="" lay-skin="nob" style="margin:0;" id="tb1">
               
                <thead>
                  <tr>
                    <th>时间</th>
                    <th>车牌号码</th>
                    <th>通道名称</th>
                    <th>操作</th>
                  </tr> 
                </thead>
                <tbody id="intbd">
                  
                </tbody>
              </table> 
            </div>
            <div class="layui-tab-item">
              <table class="layui-table" lay-even="" lay-skin="nob" style="margin:0;" id="tb2">
                
                <thead>
                  <tr>
                    <th>时间</th>
                    <th>车牌号码</th>
                    <th>通道名称</th>
                    <th>操作</th>
                  </tr> 
                </thead>

                <tbody id="outtbd">
                
                </tbody>

              </table> 
            </div>
          </div>
        </div>

    </div>

    <div class="layui-footer">
      <!-- 底部固定区域 -->
      © 高科中环
    </div>
  </div>
  <script>
  //JavaScript代码区域
  layui.use('element', function(){
    var element = layui.element;
    
  });
  </script>
  </body>
<!-- 弹出层 -->
  <div id="imp" style="display: none;"> 
    <div class="layui-card">
      <div class="layui-card-header">车辆详情</div>
      <div class="layui-card-body">
        <table class="layui-table">
          
          <thead style="width:330px">
            <tr>
              <th>车牌号码</th>
              <th>进场时间</th>
              <th>出场时间</th>
              <th>已缴费</th>
            </tr> 
          </thead>
          <tbody style="width:330px" id="cardel">
            <tr style="width:330px">
              <td>12345</td>
              <td>2016-11-29 10:00:00</td>
              <td>2016-11-29 10:00:00</td>
              <td>0</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

</html>
<script>
  $(function() {
    var myDate = new Date;
    var year = myDate.getFullYear(); //获取当前年
    var mon = myDate.getMonth() + 1; //获取当前月
    var date = myDate.getDate(); //获取当前日
    // var h = myDate.getHours();//获取当前小时数(0-23)
    // var m = myDate.getMinutes();//获取当前分钟数(0-59)
    // var s = myDate.getSeconds();//获取当前秒
    var week = myDate.getDay();
    var weeks = ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"];
    //console.log(year, mon, date, weeks[week]);
    $("#time").html(year + "年" + mon + "月" + date + "日 " + weeks[week]);

})
  function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) { return pair[1]; }
        }
        return (false);
    }
    
    var tlt;
    var comid = getQueryVariable("comid");
    if (comid == 122269) {
        tlt = "环球中心";
    } else if (comid == 122271) {
        tlt = "特星地块";
    } else if (comid == 122272) {
        tlt = "科学城智谷";
    } else if (comid == 122273) {
        tlt = "金阳安置房";
    } else if (comid == 122274) {
        tlt = "一号服务站";
    } else if (comid == 122275) {
        tlt = "艳山安置房";
    } else if (comid == 122276) {
        tlt = "留创园";
    }
    console.log(comid);
    $("#tlt").html("<div>"+tlt+"<a href='index.html' style='float: right;'>切换</a></div>");

//获取进场车辆信息  
$.ajax({
url:'https://www.gygkzhpark.com/home/api/order',
method:'post',
dataType:'json',
data:{method:'getdata_now',jsondata:JSON.stringify({comid:comid, query_type:1})}, 
success:function(d){ 
  // console.log(d);
    var inhtml;
    var incar = d;
    incar.forEach((a, i) => {
      inhtml +=  "<tr>"+
                  "<td>"+a.In_time_decode+"</td>"+
                  "<td id='num'>"+a.car_number+"</td>"+
                  "<td>"+a.in_channel+"</td>"+
                  "<td style='display:none;'>"+a.order_id+"</td>"+
                  "<td><button class='btnSelect'>查看</button></td>"+
                  "</tr>"; 
    })
    $("#incar").html(incar.length);
    $("#intbd").html(inhtml);
    //用于读取所选表行单元格数据（值）的代码
    $("#tb1").on('click','.btnSelect',function(){
     
      console.log("查看select");
      //获得当前行
      var currentRow=$(this).closest("tr"); 
      var order_id = currentRow.find("td:eq(3)").text(); //获得当前行第三个TD值
      console.log(order_id);
      d.forEach((a, i) => {
       
        //console.log(a);
        if(a.order_id == order_id){
          console.log(a);
        var incarhtml = "<tr style='width:330px'>"+
                        "<td>"+a.car_number+"</td>"+
                        "<td>"+a.In_time_decode+"</td>"+
                        "<td>"+'-'+"</td>"+
                        "<td>"+a.payable+"元</td>"+
                        "</tr>";

            $("#cardel").html(incarhtml);
            layer.open({
                        title:false,
                        type: 1,
                        content: $('#imp') //这里content是一个DOM，注意：最好该元素要存放在body最外层，否则可能被其它的相对元素所影响
                    }); 
            
        }
         
              })

    });

    }
  })

//获取出场车辆信息
$.ajax({
    url:'https://www.gygkzhpark.com/home/api/order',
    method:'post',
    dataType:'json',
    data:{method:'getdata_now',jsondata:JSON.stringify({comid:comid, query_type:2})}, 
    success:function(d){  
      console.log(d.sort());  
      outcar = d;
      var outhtml;
      var carnum;
      console.log(outcar);
      var ncost = outcar.reduce((acc, cur) => {
          //  console.log(acc);
          return acc + cur.payable
      }, 0);
      outcar.forEach((a, i) => {
       
        outhtml +=  "<tr>"+
                    "<td>"+a.Out_time_decode+"</td>"+
                    "<td>"+a.car_number+"</td>"+
                    "<td>"+a.out_channel+"</td>"+
                    "<td style='display:none;'>"+a.order_id+"</td>"+
                    "<td><button class='btnSelect1'>查看</button></td>"+
                    "</tr>"; 
       
      })
      $("#outcar").html(outcar.length);
      $("#daycost").html(ncost);
      $("#outtbd").html(outhtml);
      //调月流水
          $.ajax({
                url:'https://www.gygkzhpark.com/home/api/order',
                method:'post',
                dataType:'json',
                data:{method:'getMonthSum',jsondata:JSON.stringify({comid:comid})},
                success:function(d){
                  //console.log(ncost);
                  var monCost;
                  
                    if(d.length==0){
                    $("#moncost").html("0");
                  }else{
                    monCost = d[0].allMoney;
                    $("#moncost").html(monCost+ncost);
                  }
                  
                }
              })
        //调周流水
            $.ajax({
                  url:'https://www.gygkzhpark.com/home/api/order',
                  method:'post',
                  dataType:'json',
                  data:{method:'getWeekSum',jsondata:JSON.stringify({comid:comid})},
                  success:function(d){
                    var weekCost;
                    if(d.length==0){
                      $("#weekcost").html("0");
                    }else{
                      weekCost = d[0].allMoney;
                      $("#weekcost").html(weekCost+ncost);
                    }
                      
                  }
                })
 
      $("#tb2").on('click','.btnSelect1',function(){
        console.log("查看selec1");
          //获得当前行
          var currentRow=$(this).closest("tr");
          var carnum = currentRow.find("td:eq(1)").text(); //获得当前行第二个TD值
          var order_id = currentRow.find("td:eq(3)").text(); //获得当前行第三个TD值
       
           console.log(order_id);
          outcar.forEach((a, i) => {    
            var outcarhtml;   
          //  console.log(a);
            if(a.order_id == order_id){
              console.log(a);
               outcarhtml =  "<tr style='width:330px'>"+
                                 "<td>"+a.car_number+"</td>"+
                                 "<td>"+a.In_time_decode+"</td>"+
                                 "<td>"+a.Out_time_decode+"</td>"+
                                 "<td>"+a.payable+"元</td>"
                                 "</tr>";
              //console.log(outcarhtml);
              $("#cardel").html(outcarhtml);
              layer.open({
                title:false,
                type: 1,
                content: $('#imp') //这里content是一个DOM，注意：最好该元素要存放在body最外层，否则可能被其它的相对元素所影响
              }); 
               
            }

          })
        });

    }
  })




</script>